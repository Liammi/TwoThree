<!DOCTYPE html>
<html lang="en" xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width,initial-scale=1,user-scalable=0">
    <title>添加视频</title>
</head>
<link rel="stylesheet" href="../static/layui/css/layui.css" th:href="@{/layui/css/layui.css}">
<body>
<ul th:replace="_fragments :: menu(3)" class="layui-nav" lay-filter="">
    <li class="layui-nav-item"><a href="/home">资源列表</a></li>
    <li class="layui-nav-item"><a href="/addVideo">添加视频</a></li>
    <li class="layui-nav-item"><a href="/addVideoType">添加分类</a></li>
    <li class="layui-nav-item"><a href="/search">搜索</a></li>
    <li class="layui-nav-item" style="float: right">
        <a href="/userUpdate"><img src="https://gitee.com/inndownn/picture/raw/image/img/20210509110012.png"
                                   class="layui-nav-img" th:text="${user.nickName}" th:src="${user.avatar}"></a>
        <dl class="layui-nav-child">
            <dd><a href="/userUpdate">修改信息</a></dd>
            <dd><a href="/logout">退出</a></dd>
        </dl>
    </li>
</ul>

<fieldset class="layui-elem-field layui-field-title" style="margin-top: 30px;">
    <legend>添加影片</legend>
</fieldset>

<div class="layui-fluid">
    <form class="layui-form" action="/addVideoInfo" method="post">

        <div class="layui-form-item">
            <label class="layui-form-label">视频名称</label>
            <div class="layui-input-block">
                <input type="text" name="videoName" required lay-verify="required" placeholder="请输入视频名称"
                       autocomplete="off" class="layui-input">
            </div>
        </div>

        <div class="layui-form-item">
            <label class="layui-form-label">视频类型</label>
            <div class="layui-input-block">
                <select name="videoTypeId" lay-verify="required">
                    <option value=""></option>
                    <option value="0" th:each="type : ${types}" th:text="${type.typeName}" th:value="${type.id}">北京
                    </option>
                </select>
            </div>
        </div>

        <div class="layui-form-item">
            <label class="layui-form-label">是否上传</label>
            <div class="layui-input-block">
                <span id="filedTrue"><input type="radio" name="filed" value="true" title="上传视频文件">
                </span>
                <span id="filedFalse"><input  type="radio" name="filed" value="false" title="上传视频外链" checked>
                </span>
            </div>
        </div>

        <div class="layui-form-item layui-form-text">
            <label class="layui-form-label">视频url</label>
            <div class="layui-input-block">
                <textarea id="videoUrlId" name="videoUrl" placeholder="如果需要上传文件，上传后会自动填入，如果上传外链则手动填写" class="layui-textarea"></textarea>
            </div>
        </div>



        <div id="uploadDiv"  class="layui-form-item layui-form-text" style="display: none">
            <label class="layui-form-label">上传视频</label>
            <div class="layui-input-block">
                <button type="button" class="layui-btn" id="uploadFile">
                    <i class="layui-icon">&#xe67c;</i>上传视频
                </button>
            </div>
        </div>



        <div class="layui-form-item">
            <div class="layui-input-block">
                <button class="layui-btn  layui-btn-normal" lay-submit lay-filter="formDemo">添加</button>
                <button type="reset" class="layui-btn layui-btn-primary">重置</button>
            </div>
        </div>
    </form>
</div>


<fieldset class="layui-elem-field layui-field-title" style="margin-top: 30px;">
    <legend>影片列表</legend>
</fieldset>
<table class="layui-table layui-table-cell">
    <thead>
    <tr>
        <th>视频名称</th>
        <th>视频分类</th>
        <th>视频地址</th>
    </tr>
    </thead>
    <tbody>
    <tr th:each="info : ${infos}">
        <td th:text="${info.videoName}" width="100">贤心</td>
        <td th:text="${info.videoType.typeName}" width="100">人生就像是一场修行</td>
        <td th:text="${info.videoUrl}" width="100">贤心</td>
    </tr>
    </tbody>
</table>


</body>
<script src="../static/layui/layui.js" th:src="@{/layui/layui.js}"></script>
<script src="https://cdn.jsdelivr.net/npm/jquery@3.2/dist/jquery.min.js"></script>
<script>
    $("#filedTrue").click(function (event){
        $('#uploadDiv').css("display","block");
    });
    $("#filedFalse").click(function (event){
        $('#uploadDiv').css("display","none");
    });
    //Demo
    layui.use('form', function () {
        var form = layui.form;

        //监听提交
        form.on('submit(formDemo)', function (data) {
            // layer.msg(JSON.stringify(data.field));
            // return false;
        });
    });
    //注意：导航 依赖 element 模块，否则无法进行功能性操作
    layui.use('element', function () {
        var element = layui.element;

        //…
    });
    layui.use('upload', function () {
        var upload = layui.upload;
        var loading;
        //执行实例
        var uploadInst = upload.render({
            elem: '#uploadFile' //绑定元素
            , url: '/uploadVideo' //上传接口
            ,accept: 'video'
            ,before: function(obj){ //obj参数包含的信息，跟 choose回调完全一致，可参见上文。
                loading = layer.load(0, {
                    shade: false,
                    time: 100*1000
                });
            }
            , done: function(res, index, upload){
                
                $("#videoUrlId").val(res.url)
                layer.close(loading);
                layer.msg('上传成功');
            }
            , error: function () {
                //请求异常回调
            }
            ,size: 100000
        });
    });
</script>
</html>
