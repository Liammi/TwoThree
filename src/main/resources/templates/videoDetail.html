<!DOCTYPE html>
<html lang="en" xmlns:th="http://www.thymeleaf.org" xmlns="http://www.w3.org/1999/html">
<meta name="viewport" content="width=device-width,initial-scale=1,user-scalable=0">
<head>
    <meta charset="UTF-8">
    <title th:text="|ğŸˆğŸˆğŸˆ ${info.videoName}|">Title</title>
    <style>
        /**é‡ç½®æ ‡ç­¾é»˜è®¤æ ·å¼*/
        * {
            margin: 0;
            padding: 0;
            list-style: none;
            font-family: "Microsoft YaHei", Helvetica, "Meiryo UI", "Malgun Gothic", "Segoe UI", "Trebuchet MS", "Monaco", monospace, Tahoma, STXihei, "åæ–‡ç»†é»‘", STHeiti, "Helvetica Neue", "Droid Sans", "wenquanyi micro hei", FreeSans, Arimo, Arial, SimSun, "å®‹ä½“", Heiti, "é»‘ä½“", sans-serif;
        }

        #container {
            width: 307px;
            height: 530px;
            background: #eee;
            /*margin: 80px auto 0;*/
            position: relative;
        }

        .footer {
            width: 307px;
            height: 40px;
            position: absolute;
            bottom: 0;
            padding: 3px;
        }

        .footer input {
            width: 225px;
            height: 45px;
            outline: none;
            font-size: 3px;
            /*		text-indent: 10px;*/
            position: absolute;
            border-radius: 6px;
        }

        .footer button {
            float: right;
        }

        img {
            width: 60px;
            height: 60px;
        }

        .content {
            font-size: 10px;
            width: 307px;
            height: 460px;
            overflow: auto;
            padding: 5px;
        }

        .content li {
            /*margin-top: 5px;
            padding-left: 5px;*/
            width: 295px;
            display: block;
            clear: both;
            overflow: hidden;
        }

        /*.content li img {
            float: left;
        }*/
        .content li span {
            background: #7cfc00;
            padding: 10px;
            border-radius: 10px;
            float: left;
            margin: 6px 10px 0 10px;
            max-width: 310px;
            border: 1px solid #ccc;
            box-shadow: 0 0 3px #ccc;
        }

        /*.content li img.imgleft {
            float: left;
        }

        .content li img.imgright {
            float: right;
        }*/

        .content li span.left {
            float: left;
            background: #fff;
        }

        .content li span.right {
            float: right;
            background: #7cfc00;
        }

        /*.videoBox{
            position:relative;
            width:100%;
            height:550px;
        }
        @media (max-width: 549px){
            .videoBox{
                height: 250px;
                width: 400px;
            }
        }*/
    </style>
    <link rel="stylesheet" href="../static/layui/css/layui.css" th:href="@{/layui/css/layui.css}">
</head>
<body>
<!--å› ä¸ºiframeåŠ è½½æ…¢å¯èƒ½ä¼šå¯¼è‡´windows.onloadå‡ºç°ç¼“æ…¢åŠ è½½ï¼Œæ‰€ä»¥ä½¿ç”¨div-->
<!--UUIDæˆ¿é—´çš„å”¯ä¸€ID-->
<p id="UUID" th:text="${UUID}" STYLE="display: none">UUID</p>
<!--ç”¨æˆ·çš„IDå·ç ç”¨äºå‘é€æ¶ˆæ¯-->
<p id="id" th:text="${user.id}" STYLE="display: none">userId</p>
<!--å¥½å‹çš„IDå·ç ç”¨äºå‘é€æ¶ˆæ¯-->
<p id="anotherId" STYLE="display: none">0</p>
<fieldset class="layui-elem-field layui-field-title" style="margin-top: 10px;">
    <legend th:text="${info.videoName}">ç‰‡åï¼š8864</legend>
</fieldset>
<div class="layui-fluid">
    <div class="layui-row layui-col-space30">
        <div class="layui-col-md9">
            <div class="videoBox">
                <iframe id="iframe" height="100%" width="100%" src="https://r.yskanba.com/analysis/index?eurl=ZIgTUwUXvfd0OKMgcQRjV25S0UAQVgIY31Jka7%2Bplu4j%2B%2FD%2Ft2r0FwJA%2FFuxuuAXqNkUmMtm3%2BhrJd8xAzE2ZLNNmS5uoKQYMeJYNRyuQvE%3D&ec=jk4x"
                        frameborder="0" border="0" th:src="${info.videoUrl}"></iframe>
            </div>
        </div>
        <div class="layui-col-md3">
            <div style="height: 600px">
                <blockquote class="layui-elem-quote layui-quote-nm">
                    <span style="color:#c2c2c2">åœ¨çº¿ï¼š</span>
                    <span id="userInfo"></span>
                </blockquote>
                <!--èŠå¤©é¢æ¿container-->
                <div id="container">
                    <ul class="content">
                    </ul>
                    <!--åº•éƒ¨è¾“å…¥æ¡†ä»¥åŠå‘é€æ¡†-->
                    <div class="footer">
                        <input id="text" type="text" name="title" autocomplete="off" class="layui-input">
                        <button id="btn" onclick="start()" class="layui-btn layui-btn-lg">å‘é€</button>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

</body>
<script src="../static/layui/layui.js" th:src="@{/layui/layui.js}"></script>
<script src="https://cdn.jsdelivr.net/npm/jquery@3.2/dist/jquery.min.js"></script>
<script type="text/javascript">
    /**
     * å¤åˆ¶å†…å®¹åˆ°ç²˜è´´æ¿
     * content : éœ€è¦å¤åˆ¶çš„å†…å®¹
     * message : å¤åˆ¶å®Œåçš„æç¤ºï¼Œä¸ä¼ åˆ™é»˜è®¤æç¤º"å¤åˆ¶æˆåŠŸ"
     */
    function copyToClip(content, message) {
        var aux = document.createElement("input");
        aux.setAttribute("value", content);
        document.body.appendChild(aux);
        aux.select();
        document.execCommand("copy");
        document.body.removeChild(aux);
        layer.msg('å¤åˆ¶æˆåŠŸï¼è¯·åˆ†äº«ç»™æ‚¨çš„å¥½å‹');
    }

    /**
     * æ¨¡æ€æ¡†å¤åˆ¶
     * @type {string}
     */
    var url = window.location.toString();
    layui.use('layer', function () {
        var layer = layui.layer;
        layer.open({
            title: 'å¦‚éœ€é‚€è¯·ï¼šè¯·ç‚¹å‡»å¤åˆ¶',
            content: url,
            btn: ['å¤åˆ¶','å–æ¶ˆ'],
            yes: function () {
                copyToClip(url)
            },
            cancel: function () {
                return true
            }
        });
    });
</script>
<!--è®¾ç½®iframeæ ‡ç­¾-->
<script type="text/javascript">
    /**
     * è°ƒæ•´iframeçª—å£çš„å¤§å°
     * @type {HTMLElement}
     */
    var iframe = document.getElementById("iframe")
    document.getElementById("iframe").style.height = document.getElementById("iframe").scrollWidth * 0.65 + "px"
</script>

<script type="text/javascript">
    <!--WebSocketè¿æ¥-->
    var userInfoWebSocket = null;
    var MessageWebSocket = null;
    var content = document.getElementsByTagName('ul')[0]; //è·å–æ–‡æœ¬æ¡†çš„å†…å®¹

    function userInfoOnOpen(event) {
        console.log("ç”¨æˆ·æœåŠ¡è¿æ¥æˆåŠŸ")
    }

    function userInfoOnMessage(event) {
        console.log("ç”¨æˆ·åŠ å…¥æˆ–è€…é€€å‡º")
        $('#userInfo').html("")
        console.log(event.data);
        var userInfoList = JSON.parse(event.data);//è§£æå½“å‰æˆ¿é—´ä¸­çš„ç”¨æˆ·List
        userInfoList.forEach(function (value,index) {
            $('#userInfo').append("   "+value.nickName)
            if (value.id!==$('#id').text()){
                $('#anotherId').text(value.id);
            }
        })
        if (userInfoList.length===1){//åªæœ‰ä¸€ä¸ªç”¨æˆ·æ—¶
            $('#anotherId').text("0");
        }
    }

    function userInfoOnError(event) {
        console.log("ç”¨æˆ·æœåŠ¡è¿æ¥å‘ç”Ÿé”™è¯¯")
    }

    function userInfoOnClose(event) {
        console.log("ç”¨æˆ·æœåŠ¡è¿æ¥å…³é—­")
    }

    function twoChatOnOpen(event) {
        console.log("èŠå¤©æœåŠ¡è¿æ¥æˆåŠŸ")
    }

    function twoChatOnMessage(event) {
        var content = document.getElementsByTagName('ul')[0]; //æ§åˆ¶å±å¹•æ»šåŠ¨
        console.log("èŠå¤©æœåŠ¡æ”¶åˆ°æ¶ˆæ¯")
        console.log(event.data);
        var message = JSON.parse(event.data);
        if (message.launchId == $('#id').text()){
            //è‡ªå·±ä¸ºæ¶ˆæ¯å‘é€æ–¹æ—¶ï¼Œæ ·å¼ä¸ºé å³
            content.innerHTML += '<li><span style="float: right;background: #fff;">' + message.content + '</span></li>';
        }else {
            //å¦‚æœè‡ªå·±ä¸æ˜¯æ¶ˆæ¯å‘é€æ–¹ï¼Œæ ·å¼ä¸ºé å·¦
            content.innerHTML += '<li><span style="float: left;background: #7cfc00;">' + message.content + '</span></li>';
        }
        content.scrollTop = content.scrollHeight;
    }

    function twoChatOnError(event) {
        console.log("èŠå¤©æœåŠ¡è¿æ¥å‘ç”Ÿé”™è¯¯")
    }

    function twoChatOnClose(event) {
        console.log("èŠå¤©æœåŠ¡è¿æ¥å…³é—­")
    }

    $(document).ready(
        function () {
            var homeId = $('#UUID').text();
            var userId = $('#id').text();
            var serverHot = window.location.host;
            userInfoWebSocket = new WebSocket('ws://' + serverHot + '/userInfoTransfer/' + homeId + '/' + userId);

            userInfoWebSocket.onopen = function (event) {
                userInfoOnOpen(event)
            };
            userInfoWebSocket.onmessage = function (event) {
                userInfoOnMessage(event)
            };
            userInfoWebSocket.onerror = function (event) {
                userInfoOnError(event)
            };
            userInfoWebSocket.onclose = function (event) {
                userInfoOnClose(event)
            };

            //----------------------------jsäº‹ä»¶å¤„ç†æœºåˆ¶ï¼Œåˆ›å»ºä¸€ä¸ªæ–°è¿æ¥---------------------------

            MessageWebSocket = new WebSocket('ws://' + serverHot + '/twoChat/' + homeId);

            MessageWebSocket.onopen = function (event) {
                twoChatOnOpen(event);
            }
            MessageWebSocket.onmessage = function (ev) {
                twoChatOnMessage(ev)
            }
            MessageWebSocket.onerror = function (ev) {
                twoChatOnError(ev)
            }
            MessageWebSocket.onclose = function (ev) {
                twoChatOnClose(ev)
            }
        }
    )

    /*å‘é€æ¶ˆæ¯çš„é€»è¾‘*/
    function start() {
        var userId = $('#id').text();
        var anotherUserId = $('#anotherId').text();
        var content = document.getElementsByTagName('ul')[0]; //æ§åˆ¶å±å¹•æ»šåŠ¨
        var text = document.getElementById('text'); //è·å–è¾“å…¥å†…å®¹
        if (text.value === '') {
            console.log("è¾“å…¥ä¿¡æ¯ä¸ºç©º")
        } else {
            var message = {
                launchId: userId,
                receiveId: anotherUserId,//ç”¨æˆ·æäº¤receiveId,é»˜è®¤ä¸º0ï¼Œä»£è¡¨åªæœ‰ä¸€ä¸ªäººæ¥èŠå¤©ã€‚
                content: text.value
            }
            MessageWebSocket.send(JSON.stringify(message));
            text.value = '';//é‡ç½®text.value
            content.scrollTop = content.scrollHeight;// å†…å®¹è¿‡å¤šæ—¶,å°†æ»šåŠ¨æ¡æ”¾ç½®åˆ°æœ€åº•ç«¯
            //å‘é€socketè¿æ¥ä¿¡æ¯
        }
    }
</script>
<script>
    // ç›‘æ§enteré”®ï¼šå‘é€ä¿¡æ¯
    $(document).keyup(function (e) {
        var key = e.which;
        if (key === 13) {
            start();
        }
    });
</script>
</html>